@startuml
actor Usuario

== Registrar Venta ==

Usuario -> PantallaVentas : ingresarModulo("VENTAS")
PantallaVentas -> ControladorVentas : mostrarCampoCliente()

Usuario -> PantallaVentas : ingresarNombreCliente(nombre)
PantallaVentas -> ControladorVentas : buscarCliente(nombre)
ControladorVentas -> Cliente : obtenerPorNombre(nombre)
Cliente --> ControladorVentas : listaClientes

alt Clientes encontrados
    ControladorVentas --> PantallaVentas : mostrarClientes(listaClientes)
    Usuario -> PantallaVentas : seleccionarCliente()
    PantallaVentas -> ControladorVentas : mostrarFormularioCompra()
    
    Usuario -> PantallaVentas : completarFormulario(marca, modelo, cantidad)
    Usuario -> PantallaVentas : seleccionarBoton("GUARDAR")
    PantallaVentas -> ControladorVentas : validarDatos()
    
    alt Datos válidos
        ControladorVentas -> Usuario : solicitarConfirmacion()
        Usuario -> PantallaVentas : confirmar("Sí")
        PantallaVentas -> ControladorVentas : registrarCompra()
        ControladorVentas -> BaseDeDatos : guardarCompra(datos)
        BaseDeDatos --> ControladorVentas : confirmación
        ControladorVentas -> Inventario : actualizarStock(marca, cantidad)
        Inventario --> ControladorVentas : stockActualizado
        ControladorVentas --> PantallaVentas : mostrarMensaje("Venta registrada")
    else Datos inválidos
        ControladorVentas --> PantallaVentas : mostrarErroresValidacion()
        PantallaVentas -> ControladorVentas : retornarPaso(3)
    end
    
else Cliente no encontrado
    ControladorVentas --> PantallaVentas : mostrarMensaje("Cliente no registrado")
end

== Alternativa: Cancelar ==
Usuario -> PantallaVentas : seleccionarBoton("DESCARTAR")
PantallaVentas -> ControladorVentas : cancelarOperacion()
ControladorVentas --> PantallaVentas : cerrarPantalla()

@enduml
